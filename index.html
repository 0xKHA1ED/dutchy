<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dutch Dash - Stories</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&display=swap');

        body {
            font-family: 'Outfit', sans-serif;
            background-color: #f8fafc;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #c7c7cc;
            border-radius: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #a1a1aa;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body
    class="h-screen flex flex-col items-center justify-center overflow-hidden bg-gradient-to-br from-slate-100 to-blue-50 text-slate-800">

    <div id="app-container"
        class="w-full max-w-md md:max-w-4xl bg-white/80 backdrop-blur-xl md:rounded-[2.5rem] shadow-2xl overflow-hidden h-full md:h-[85vh] flex flex-col relative border border-white/50 ring-1 ring-black/5">

        <!-- Header -->
        <div
            class="bg-white/90 backdrop-blur-md p-4 md:p-6 text-slate-800 flex justify-between items-center border-b border-slate-100 z-10 shrink-0">
            <div class="flex items-center">
                <button id="back-button" onclick="showList()"
                    class="hidden mr-4 text-slate-500 hover:text-indigo-600 transition p-2 rounded-full hover:bg-slate-100">
                    <i class="fas fa-chevron-left text-lg"></i>
                </button>
                <h1 id="header-title" class="font-extrabold text-xl tracking-tight text-slate-800 flex items-center">
                    <i class="fas fa-book-open mr-2 text-indigo-600"></i>Stories
                </h1>
            </div>
        </div>

        <!-- Progress Bar (Visual only for now) -->
        <div class="w-full bg-gray-200 h-1 shrink-0">
            <div class="bg-indigo-500 h-1 w-0 transition-all duration-300 shadow-[0_0_10px_rgba(99,102,241,0.5)]"></div>
        </div>

        <div class="flex-1 overflow-hidden relative">

            <!-- Story List -->
            <div id="story-list" class="absolute inset-0 p-6 md:p-10 overflow-y-auto custom-scrollbar">
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-bold text-gray-800">Choose a Story</h2>
                    <p class="text-gray-500 text-sm">Practice your listening and reading skills</p>
                </div>

                <div id="stories-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pb-4">
                    <!-- Stories will be injected here -->
                    <div class="col-span-full text-center text-slate-400 py-10">
                        <i class="fas fa-circle-notch fa-spin mr-2"></i> Loading stories...
                    </div>
                </div>
            </div>

            <!-- Story Detail -->
            <div id="story-detail" class="absolute inset-0 flex flex-col overflow-hidden bg-white hidden">
                <div class="flex-1 overflow-y-auto custom-scrollbar p-6 md:p-10">
                    <div class="max-w-3xl mx-auto">

                        <!-- Hero Image & Audio -->
                        <div class="flex flex-col md:flex-row gap-6 mb-8 items-center">
                            <div class="w-full md:w-1/3 shrink-0">
                                <div
                                    class="aspect-square rounded-2xl overflow-hidden shadow-lg border-4 border-white bg-slate-100">
                                    <img id="detail-image" src="" class="w-full h-full object-cover" alt="Story Image">
                                </div>
                            </div>
                            <div class="w-full md:w-2/3">
                                <h2 id="detail-title" class="text-3xl font-extrabold text-slate-800 mb-4 leading-tight">
                                </h2>

                                <div class="bg-indigo-50 rounded-xl p-4 border border-indigo-100">
                                    <audio id="audio-player" controls class="w-full accent-indigo-600">
                                        Your browser does not support the audio element.
                                    </audio>
                                </div>
                            </div>
                        </div>

                        <!-- Text Content -->
                        <div id="detail-text"
                            class="prose prose-lg prose-slate max-w-none text-slate-600 leading-relaxed">
                            <!-- Text goes here -->
                        </div>

                    </div>
                </div>
            </div>

        </div>

    </div>

    <script>
        // State
        let stories = [];

        const els = {
            list: document.getElementById('story-list'),
            detail: document.getElementById('story-detail'),
            grid: document.getElementById('stories-grid'),
            backBtn: document.getElementById('back-button'),
            headerTitle: document.getElementById('header-title'),
            detailImage: document.getElementById('detail-image'),
            detailTitle: document.getElementById('detail-title'),
            detailText: document.getElementById('detail-text'),
            audioPlayer: document.getElementById('audio-player')
        };

        async function init() {
            try {
                const response = await fetch('data/stories.json');
                if (!response.ok) {
                    throw new Error('Failed to load stories');
                }
                stories = await response.json();
                renderList();
            } catch (error) {
                console.error(error);
                els.grid.innerHTML = `<div class="col-span-full text-center text-red-500 py-10">Failed to load stories.<br>${error.message}</div>`;
            }
        }

        function renderList() {
            els.grid.innerHTML = '';
            stories.forEach(story => {
                const card = document.createElement('div');
                card.className = "bg-white rounded-2xl shadow-sm hover:shadow-xl border border-slate-100 overflow-hidden cursor-pointer transition-all duration-300 transform hover:-translate-y-1 group fade-in";
                card.onclick = () => openStory(story);

                // Use dummy image if not provided
                const imageUrl = story.image || 'https://placehold.co/400x300?text=No+Image';

                card.innerHTML = `
                    <div class="h-40 overflow-hidden bg-slate-100 relative">
                        <img src="${imageUrl}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" onerror="this.src='https://placehold.co/400x300?text=No+Image'">
                        <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors"></div>
                        <div class="absolute bottom-3 right-3 bg-white/90 backdrop-blur px-3 py-1 rounded-full text-xs font-bold text-indigo-600 shadow-sm">
                            <i class="fas fa-headphones mr-1"></i> Listen
                        </div>
                    </div>
                    <div class="p-5">
                        <h3 class="font-bold text-lg text-slate-800 mb-1 group-hover:text-indigo-600 transition-colors line-clamp-1">${story.title}</h3>
                        <p class="text-sm text-slate-400 line-clamp-2">${story.body.substring(0, 100)}...</p>
                    </div>
                `;
                els.grid.appendChild(card);
            });
        }

        function openStory(story) {
            // Populate Detail
            els.detailImage.src = story.image || 'https://placehold.co/600x600?text=Story';
            els.detailTitle.textContent = story.title;

            // Format text: simple paragraphs
            els.detailText.innerHTML = story.body.split('\n').filter(line => line.trim() !== '').map(line => `<p class="mb-4">${line}</p>`).join('');

            // Dummy audio if missing
            els.audioPlayer.src = story.audio || '#';
            els.audioPlayer.load();

            // Switch View
            els.list.classList.add('hidden');
            els.detail.classList.remove('hidden');
            els.backBtn.classList.remove('hidden');

            // Update Header
            els.headerTitle.innerHTML = `<span class="truncate max-w-[200px]">${story.title}</span>`;
        }

        function showList() {
            els.detail.classList.add('hidden');
            els.list.classList.remove('hidden');
            els.backBtn.classList.add('hidden');

            // Stop audio
            els.audioPlayer.pause();

            // Reset Header
            els.headerTitle.innerHTML = `<i class="fas fa-book-open mr-2 text-indigo-600"></i>Stories`;
        }

        // Initialize
        init();

    </script>
</body>

</html>